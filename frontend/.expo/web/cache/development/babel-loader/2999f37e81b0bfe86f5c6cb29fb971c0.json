{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Entypo, Feather, FontAwesome5 } from '@expo/vector-icons';\nimport { useIsFocused } from '@react-navigation/native';\nimport { Video } from 'expo-av';\nimport VideoPlayer from 'expo-video-player';\nimport firebase from 'firebase';\nimport React, { useEffect, useRef, useState } from 'react';\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport View from \"react-native-web/dist/exports/View\";\nimport BottomSheet from 'react-native-bottomsheet-reanimated';\nimport { Divider, Snackbar } from 'react-native-paper';\nimport ParsedText from 'react-native-parsed-text';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { deletePost, fetchUserPosts, sendNotification } from \"../../../redux/actions/index\";\nimport { container, text, utils } from \"../../styles\";\nimport { timeDifference } from \"../../utils\";\nimport CachedImage from \"../random/CachedImage\";\n\nrequire('firebase/firestore');\n\nvar WINDOW_WIDTH = Dimensions.get(\"window\").width;\n\nfunction Post(props) {\n  var _useState = useState(props.route.params.item),\n      _useState2 = _slicedToArray(_useState, 2),\n      item = _useState2[0],\n      setItem = _useState2[1];\n\n  var _useState3 = useState(props.route.params.user),\n      _useState4 = _slicedToArray(_useState3, 2),\n      user = _useState4[0],\n      setUser = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      currentUserLike = _useState6[0],\n      setCurrentUserLike = _useState6[1];\n\n  var _useState7 = useState(true),\n      _useState8 = _slicedToArray(_useState7, 2),\n      unmutted = _useState8[0],\n      setUnmutted = _useState8[1];\n\n  var _useState9 = useState(null),\n      _useState10 = _slicedToArray(_useState9, 2),\n      videoref = _useState10[0],\n      setvideoref = _useState10[1];\n\n  var _useState11 = useState(useRef(null)),\n      _useState12 = _slicedToArray(_useState11, 2),\n      sheetRef = _useState12[0],\n      setSheetRef = _useState12[1];\n\n  var _useState13 = useState({\n    visible: false,\n    item: null\n  }),\n      _useState14 = _slicedToArray(_useState13, 2),\n      modalShow = _useState14[0],\n      setModalShow = _useState14[1];\n\n  var _useState15 = useState(true),\n      _useState16 = _slicedToArray(_useState15, 2),\n      isValid = _useState16[0],\n      setIsValid = _useState16[1];\n\n  var _useState17 = useState(false),\n      _useState18 = _slicedToArray(_useState17, 2),\n      exists = _useState18[0],\n      setExists = _useState18[1];\n\n  var _useState19 = useState(false),\n      _useState20 = _slicedToArray(_useState19, 2),\n      loaded = _useState20[0],\n      setLoaded = _useState20[1];\n\n  var isFocused = useIsFocused();\n  useEffect(function () {\n    if (props.route.params.notification != undefined) {\n      firebase.firestore().collection(\"users\").doc(props.route.params.user).get().then(function (snapshot) {\n        if (snapshot.exists) {\n          var _user = snapshot.data();\n\n          _user.uid = snapshot.id;\n          setUser(_user);\n        }\n      });\n      firebase.firestore().collection(\"posts\").doc(props.route.params.user).collection(\"userPosts\").doc(props.route.params.item).get().then(function (snapshot) {\n        if (snapshot.exists) {\n          var post = snapshot.data();\n          post.id = snapshot.id;\n          setItem(post);\n          setLoaded(true);\n          setExists(true);\n        }\n      });\n      firebase.firestore().collection(\"posts\").doc(props.route.params.user).collection(\"userPosts\").doc(props.route.params.item).collection(\"likes\").doc(firebase.auth().currentUser.uid).onSnapshot(function (snapshot) {\n        var currentUserLike = false;\n\n        if (snapshot.exists) {\n          currentUserLike = true;\n        }\n\n        setCurrentUserLike(currentUserLike);\n      });\n    } else {\n      firebase.firestore().collection(\"posts\").doc(props.route.params.user.uid).collection(\"userPosts\").doc(props.route.params.item.id).collection(\"likes\").doc(firebase.auth().currentUser.uid).onSnapshot(function (snapshot) {\n        var currentUserLike = false;\n\n        if (snapshot.exists) {\n          currentUserLike = true;\n        }\n\n        setCurrentUserLike(currentUserLike);\n      });\n      setItem(props.route.params.item);\n      setUser(props.route.params.user);\n      setLoaded(true);\n      setExists(true);\n    }\n  }, [props.route.params.notification, props.route.params.item]);\n  useEffect(function () {\n    if (videoref !== null) {\n      videoref.setIsMutedAsync(props.route.params.unmutted);\n    }\n\n    setUnmutted(props.route.params.unmutted);\n  }, [props.route.params.unmutted]);\n  useEffect(function () {\n    if (videoref !== null) {\n      if (isFocused) {\n        videoref.playAsync();\n      } else {\n        videoref.stopAsync();\n      }\n    }\n  }, [props.route.params.index, props.route.params.inViewPort]);\n\n  var onUsernamePress = function onUsernamePress(username, matchIndex) {\n    props.navigation.navigate(\"ProfileOther\", {\n      username: username,\n      uid: undefined\n    });\n  };\n\n  var onLikePress = function onLikePress(userId, postId, item) {\n    item.likesCount += 1;\n    setCurrentUserLike(true);\n    firebase.firestore().collection(\"posts\").doc(userId).collection(\"userPosts\").doc(postId).collection(\"likes\").doc(firebase.auth().currentUser.uid).set({}).then();\n    props.sendNotification(user.notificationToken, \"New Like\", props.currentUser.name + \" liked your post\", {\n      type: 0,\n      postId: postId,\n      user: firebase.auth().currentUser.uid\n    });\n  };\n\n  var onDislikePress = function onDislikePress(userId, postId, item) {\n    item.likesCount -= 1;\n    setCurrentUserLike(false);\n    firebase.firestore().collection(\"posts\").doc(userId).collection(\"userPosts\").doc(postId).collection(\"likes\").doc(firebase.auth().currentUser.uid).delete();\n  };\n\n  if (!exists && loaded) {\n    return React.createElement(View, {\n      style: {\n        height: '100%',\n        justifyContent: 'center',\n        margin: 'auto'\n      }\n    }, React.createElement(FontAwesome5, {\n      style: {\n        alignSelf: 'center',\n        marginBottom: 20\n      },\n      name: \"dizzy\",\n      size: 40,\n      color: \"black\"\n    }), React.createElement(Text, {\n      style: [text.notAvailable]\n    }, \"Post does not exist\"));\n  }\n\n  if (!loaded) {\n    return React.createElement(View, null);\n  }\n\n  if (user == undefined) {\n    return React.createElement(View, null);\n  }\n\n  if (item == null) {\n    return React.createElement(View, null);\n  }\n\n  var _handleVideoRef = function _handleVideoRef(component) {\n    setvideoref(component);\n\n    if (component !== null) {\n      component.setIsMutedAsync(props.route.params.unmutted);\n    }\n  };\n\n  if (videoref !== null) {\n    videoref.setIsMutedAsync(unmutted);\n\n    if (isFocused && props.route.params.index == props.route.params.inViewPort) {\n      videoref.playAsync();\n    } else {\n      videoref.stopAsync();\n    }\n  }\n\n  if (sheetRef.current !== null && !props.route.params.feed) {\n    if (modalShow.visible) {\n      sheetRef.snapTo(0);\n    } else {\n      sheetRef.snapTo(1);\n    }\n  }\n\n  return React.createElement(View, {\n    style: [container.container, utils.backgroundWhite]\n  }, React.createElement(View, null, React.createElement(View, {\n    style: [container.horizontal, {\n      alignItems: 'center',\n      padding: 10\n    }]\n  }, React.createElement(TouchableOpacity, {\n    style: [container.horizontal, {\n      alignItems: 'center'\n    }],\n    onPress: function onPress() {\n      return props.navigation.navigate(\"ProfileOther\", {\n        uid: user.uid,\n        username: undefined\n      });\n    }\n  }, user.image == 'default' ? React.createElement(FontAwesome5, {\n    style: [utils.profileImageSmall],\n    name: \"user-circle\",\n    size: 35,\n    color: \"black\"\n  }) : React.createElement(Image, {\n    style: [utils.profileImageSmall],\n    source: {\n      uri: user.image\n    }\n  }), React.createElement(View, {\n    style: {\n      alignSelf: 'center'\n    }\n  }, React.createElement(Text, {\n    style: [text.bold, text.medium, {\n      marginBottom: 0\n    }]\n  }, user.name))), React.createElement(TouchableOpacity, {\n    style: [{\n      marginLeft: 'auto'\n    }],\n    onPress: function onPress() {\n      if (props.route.params.feed) {\n        props.route.params.setModalShow({\n          visible: true,\n          item: item\n        });\n      } else {\n        setModalShow({\n          visible: true,\n          item: item\n        });\n      }\n    }\n  }, React.createElement(Feather, {\n    name: \"more-vertical\",\n    size: 20,\n    color: \"black\"\n  }))), item.type == 0 ? React.createElement(View, null, props.route.params.index == props.route.params.inViewPort && isFocused ? React.createElement(View, null, React.createElement(VideoPlayer, {\n    videoProps: {\n      isLooping: true,\n      shouldPlay: true,\n      resizeMode: Video.RESIZE_MODE_COVER,\n      source: {\n        uri: item.downloadURL\n      },\n      videoRef: _handleVideoRef\n    },\n    inFullscreen: false,\n    showControlsOnLoad: true,\n    showFullscreenButton: false,\n    height: WINDOW_WIDTH,\n    width: WINDOW_WIDTH,\n    shouldPlay: true,\n    isLooping: true,\n    style: {\n      aspectRatio: 1 / 1,\n      height: WINDOW_WIDTH,\n      width: WINDOW_WIDTH,\n      backgroundColor: 'black'\n    }\n  }), React.createElement(TouchableOpacity, {\n    style: {\n      position: 'absolute',\n      borderRadius: 500,\n      backgroundColor: 'black',\n      width: 40,\n      height: 40,\n      alignItems: 'center',\n      justifyContent: 'center',\n      margin: 10,\n      right: 0\n    },\n    activeOpacity: 1,\n    onPress: function onPress() {\n      if (videoref == null) {\n        return;\n      }\n\n      if (unmutted) {\n        if (props.route.params.setUnmuttedMain == undefined) {\n          setUnmutted(false);\n        } else {\n          props.route.params.setUnmuttedMain(false);\n        }\n      } else {\n        if (props.route.params.setUnmuttedMain == undefined) {\n          setUnmutted(true);\n        } else {\n          props.route.params.setUnmuttedMain(true);\n        }\n      }\n    }\n  }, !unmutted ? React.createElement(Feather, {\n    name: \"volume-2\",\n    size: 20,\n    color: \"white\"\n  }) : React.createElement(Feather, {\n    name: \"volume-x\",\n    size: 20,\n    color: \"white\"\n  }))) : React.createElement(View, {\n    style: {\n      marginTop: 4\n    }\n  }, React.createElement(CachedImage, {\n    cacheKey: item.id,\n    style: [container.image],\n    source: {\n      uri: item.downloadURLStill\n    }\n  }))) : React.createElement(CachedImage, {\n    cacheKey: item.id,\n    style: container.image,\n    source: {\n      uri: item.downloadURL\n    }\n  }), React.createElement(View, {\n    style: [utils.padding10, container.horizontal]\n  }, currentUserLike ? React.createElement(Entypo, {\n    name: \"heart\",\n    size: 30,\n    color: \"red\",\n    onPress: function onPress() {\n      return onDislikePress(user.uid, item.id, item);\n    }\n  }) : React.createElement(Feather, {\n    name: \"heart\",\n    size: 30,\n    color: \"black\",\n    onPress: function onPress() {\n      return onLikePress(user.uid, item.id, item);\n    }\n  }), React.createElement(Feather, {\n    style: utils.margin15Left,\n    name: \"message-square\",\n    size: 30,\n    color: \"black\",\n    onPress: function onPress() {\n      return props.navigation.navigate('Comment', {\n        postId: item.id,\n        uid: user.uid,\n        user: user\n      });\n    }\n  }), React.createElement(Feather, {\n    style: utils.margin15Left,\n    name: \"share\",\n    size: 26,\n    color: \"black\",\n    onPress: function onPress() {\n      return props.navigation.navigate('ChatList', {\n        postId: item.id,\n        post: _objectSpread(_objectSpread({}, item), {}, {\n          user: user\n        }),\n        share: true\n      });\n    }\n  })), React.createElement(View, {\n    style: [container.container, utils.padding10Sides]\n  }, React.createElement(Text, {\n    style: [text.bold, text.medium]\n  }, item.likesCount, \" likes\"), React.createElement(Text, {\n    style: [utils.margin15Right, utils.margin5Bottom]\n  }, React.createElement(Text, {\n    style: [text.bold],\n    onPress: function onPress() {\n      return props.navigation.navigate(\"ProfileOther\", {\n        uid: user.uid,\n        username: undefined\n      });\n    }\n  }, user.name), React.createElement(Text, null, \"    \"), React.createElement(ParsedText, {\n    parse: [{\n      pattern: /@(\\w+)/,\n      style: {\n        color: 'green',\n        fontWeight: 'bold'\n      },\n      onPress: onUsernamePress\n    }]\n  }, item.caption)), React.createElement(Text, {\n    style: [text.grey, utils.margin5Bottom],\n    onPress: function onPress() {\n      return props.navigation.navigate('Comment', {\n        postId: item.id,\n        uid: user.uid,\n        user: user\n      });\n    }\n  }, \"View all \", item.commentsCount, \" Comments\"), React.createElement(Text, {\n    style: [text.grey, text.small, utils.margin5Bottom]\n  }, timeDifference(new Date(), item.creation.toDate())))), React.createElement(BottomSheet, {\n    bottomSheerColor: \"#FFFFFF\",\n    ref: setSheetRef,\n    initialPosition: 0,\n    snapPoints: [300, 0],\n    isBackDrop: true,\n    isBackDropDismissByPress: true,\n    isRoundBorderWithTipHeader: true,\n    backDropColor: \"black\",\n    isModal: true,\n    containerStyle: {\n      backgroundColor: \"white\"\n    },\n    tipStyle: {\n      backgroundColor: \"white\"\n    },\n    headerStyle: {\n      backgroundColor: \"white\",\n      flex: 1\n    },\n    bodyStyle: {\n      backgroundColor: \"white\",\n      flex: 1,\n      borderRadius: 20\n    },\n    body: React.createElement(View, null, modalShow.item != null ? React.createElement(View, null, React.createElement(TouchableOpacity, {\n      style: {\n        padding: 20\n      },\n      onPress: function onPress() {\n        props.navigation.navigate(\"ProfileOther\", {\n          uid: modalShow.item.user.uid,\n          username: undefined\n        });\n        setModalShow({\n          visible: false,\n          item: null\n        });\n      }\n    }, React.createElement(Text, null, \"Profile\")), React.createElement(Divider, null), props.route.params.user.uid == firebase.auth().currentUser.uid ? React.createElement(TouchableOpacity, {\n      style: {\n        padding: 20\n      },\n      onPress: function onPress() {\n        props.deletePost(modalShow.item).then(function () {\n          props.fetchUserPosts();\n          props.navigation.popToTop();\n        });\n        setModalShow({\n          visible: false,\n          item: null\n        });\n      }\n    }, React.createElement(Text, null, \"Delete\")) : null, React.createElement(Divider, null), React.createElement(TouchableOpacity, {\n      style: {\n        padding: 20\n      },\n      onPress: function onPress() {\n        return setModalShow({\n          visible: false,\n          item: null\n        });\n      }\n    }, React.createElement(Text, null, \"Cancel\"))) : null)\n  }), React.createElement(Snackbar, {\n    visible: isValid.boolSnack,\n    duration: 2000,\n    onDismiss: function onDismiss() {\n      setIsValid({\n        boolSnack: false\n      });\n    }\n  }, isValid.message));\n}\n\nvar mapStateToProps = function mapStateToProps(store) {\n  return {\n    currentUser: store.userState.currentUser,\n    following: store.userState.following,\n    feed: store.usersState.feed,\n    usersFollowingLoaded: store.usersState.usersFollowingLoaded\n  };\n};\n\nvar mapDispatchProps = function mapDispatchProps(dispatch) {\n  return bindActionCreators({\n    sendNotification: sendNotification,\n    fetchUserPosts: fetchUserPosts,\n    deletePost: deletePost\n  }, dispatch);\n};\n\nexport default connect(mapStateToProps, mapDispatchProps)(Post);","map":{"version":3,"sources":["/Users/jimymarletta/Downloads/instagram_redesign_release_v2/frontend/components/main/post/Post.js"],"names":["Entypo","Feather","FontAwesome5","useIsFocused","Video","VideoPlayer","firebase","React","useEffect","useRef","useState","BottomSheet","Divider","Snackbar","ParsedText","connect","bindActionCreators","deletePost","fetchUserPosts","sendNotification","container","text","utils","timeDifference","CachedImage","require","WINDOW_WIDTH","Dimensions","get","width","Post","props","route","params","item","setItem","user","setUser","currentUserLike","setCurrentUserLike","unmutted","setUnmutted","videoref","setvideoref","sheetRef","setSheetRef","visible","modalShow","setModalShow","isValid","setIsValid","exists","setExists","loaded","setLoaded","isFocused","notification","undefined","firestore","collection","doc","then","snapshot","data","uid","id","post","auth","currentUser","onSnapshot","setIsMutedAsync","playAsync","stopAsync","index","inViewPort","onUsernamePress","username","matchIndex","navigation","navigate","onLikePress","userId","postId","likesCount","set","notificationToken","name","type","onDislikePress","delete","height","justifyContent","margin","alignSelf","marginBottom","notAvailable","_handleVideoRef","component","current","feed","snapTo","backgroundWhite","horizontal","alignItems","padding","image","profileImageSmall","uri","bold","medium","marginLeft","isLooping","shouldPlay","resizeMode","RESIZE_MODE_COVER","source","downloadURL","videoRef","aspectRatio","backgroundColor","position","borderRadius","right","setUnmuttedMain","marginTop","downloadURLStill","padding10","margin15Left","share","padding10Sides","margin15Right","margin5Bottom","pattern","style","color","fontWeight","onPress","caption","grey","commentsCount","small","Date","creation","toDate","flex","popToTop","boolSnack","message","mapStateToProps","store","userState","following","usersState","usersFollowingLoaded","mapDispatchProps","dispatch"],"mappings":"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","sourcesContent":["import { Entypo, Feather, FontAwesome5 } from '@expo/vector-icons';\nimport { useIsFocused } from '@react-navigation/native';\nimport { Video } from 'expo-av';\nimport VideoPlayer from 'expo-video-player';\nimport firebase from 'firebase';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { Dimensions, Image, Text, TouchableOpacity, View } from 'react-native';\nimport BottomSheet from 'react-native-bottomsheet-reanimated';\nimport { Divider, Snackbar } from 'react-native-paper';\nimport ParsedText from 'react-native-parsed-text';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { deletePost, fetchUserPosts, sendNotification } from '../../../redux/actions/index';\nimport { container, text, utils } from '../../styles';\nimport { timeDifference } from '../../utils';\nimport CachedImage from '../random/CachedImage';\nrequire('firebase/firestore')\n\n\n\nconst WINDOW_WIDTH = Dimensions.get(\"window\").width;\n\nfunction Post(props) {\n    const [item, setItem] = useState(props.route.params.item)\n    const [user, setUser] = useState(props.route.params.user)\n    const [currentUserLike, setCurrentUserLike] = useState(false)\n    const [unmutted, setUnmutted] = useState(true)\n    const [videoref, setvideoref] = useState(null)\n    const [sheetRef, setSheetRef] = useState(useRef(null))\n    const [modalShow, setModalShow] = useState({ visible: false, item: null })\n    const [isValid, setIsValid] = useState(true);\n    const [exists, setExists] = useState(false);\n    const [loaded, setLoaded] = useState(false);\n\n    const isFocused = useIsFocused();\n    useEffect(() => {\n\n        if (props.route.params.notification != undefined) {\n\n            firebase.firestore()\n                .collection(\"users\")\n                .doc(props.route.params.user)\n                .get()\n                .then((snapshot) => {\n                    if (snapshot.exists) {\n                        let user = snapshot.data();\n                        user.uid = snapshot.id;\n\n                        setUser(user)\n                    }\n                })\n\n            firebase.firestore()\n                .collection(\"posts\")\n                .doc(props.route.params.user)\n                .collection(\"userPosts\")\n                .doc(props.route.params.item)\n                .get()\n                .then((snapshot) => {\n                    if (snapshot.exists) {\n                        let post = snapshot.data();\n                        post.id = snapshot.id;\n\n                        setItem(post)\n                        setLoaded(true)\n                        setExists(true)\n                    }\n                })\n            firebase.firestore()\n                .collection(\"posts\")\n                .doc(props.route.params.user)\n                .collection(\"userPosts\")\n                .doc(props.route.params.item)\n                .collection(\"likes\")\n                .doc(firebase.auth().currentUser.uid)\n                .onSnapshot((snapshot) => {\n                    let currentUserLike = false;\n                    if (snapshot.exists) {\n                        currentUserLike = true;\n                    }\n                    setCurrentUserLike(currentUserLike)\n\n                })\n\n        }\n        else {\n            firebase.firestore()\n                .collection(\"posts\")\n                .doc(props.route.params.user.uid)\n                .collection(\"userPosts\")\n                .doc(props.route.params.item.id)\n                .collection(\"likes\")\n                .doc(firebase.auth().currentUser.uid)\n                .onSnapshot((snapshot) => {\n                    let currentUserLike = false;\n                    if (snapshot.exists) {\n                        currentUserLike = true;\n                    }\n                    setCurrentUserLike(currentUserLike)\n\n                })\n\n            setItem(props.route.params.item)\n            setUser(props.route.params.user)\n            setLoaded(true)\n            setExists(true)\n        }\n\n    }, [props.route.params.notification, props.route.params.item])\n\n    useEffect(() => {\n        if (videoref !== null) {\n            videoref.setIsMutedAsync(props.route.params.unmutted)\n        }\n        setUnmutted(props.route.params.unmutted)\n    }, [props.route.params.unmutted])\n\n    useEffect(() => {\n        if (videoref !== null) {\n            if (isFocused) {\n                videoref.playAsync()\n            } else {\n                videoref.stopAsync()\n\n            }\n        }\n\n    }, [props.route.params.index, props.route.params.inViewPort])\n\n    const onUsernamePress = (username, matchIndex) => {\n        props.navigation.navigate(\"ProfileOther\", { username, uid: undefined })\n    }\n\n    const onLikePress = (userId, postId, item) => {\n        item.likesCount += 1;\n        setCurrentUserLike(true)\n        firebase.firestore()\n            .collection(\"posts\")\n            .doc(userId)\n            .collection(\"userPosts\")\n            .doc(postId)\n            .collection(\"likes\")\n            .doc(firebase.auth().currentUser.uid)\n            .set({})\n            .then()\n        props.sendNotification(user.notificationToken, \"New Like\", `${props.currentUser.name} liked your post`, { type: 0, postId, user: firebase.auth().currentUser.uid })\n\n    }\n    const onDislikePress = (userId, postId, item) => {\n        item.likesCount -= 1;\n\n        setCurrentUserLike(false)\n        firebase.firestore()\n            .collection(\"posts\")\n            .doc(userId)\n            .collection(\"userPosts\")\n            .doc(postId)\n            .collection(\"likes\")\n            .doc(firebase.auth().currentUser.uid)\n            .delete()\n    }\n    if (!exists && loaded) {\n        return (\n            <View style={{ height: '100%', justifyContent: 'center', margin: 'auto' }}>\n                <FontAwesome5 style={{ alignSelf: 'center', marginBottom: 20 }} name=\"dizzy\" size={40} color=\"black\" />\n                <Text style={[text.notAvailable]}>Post does not exist</Text>\n            </View>\n        )\n    }\n    if (!loaded) {\n        return (<View></View>)\n\n    }\n    if (user == undefined) {\n        return (<View></View>)\n    }\n    if (item == null) {\n        return (<View />)\n    }\n\n    const _handleVideoRef = (component) => {\n        setvideoref(component);\n\n        if (component !== null) {\n            component.setIsMutedAsync(props.route.params.unmutted)\n        }\n    }\n\n    if (videoref !== null) {\n        videoref.setIsMutedAsync(unmutted)\n        if (isFocused && props.route.params.index == props.route.params.inViewPort) {\n            videoref.playAsync()\n        } else {\n            videoref.stopAsync()\n\n        }\n    }\n\n\n    if (sheetRef.current !== null && !props.route.params.feed) {\n        if (modalShow.visible) {\n            sheetRef.snapTo(0)\n        } else {\n            sheetRef.snapTo(1)\n        }\n    }\n\n    return (\n        <View style={[container.container, utils.backgroundWhite]}>\n\n            <View>\n                <View style={[container.horizontal, { alignItems: 'center', padding: 10 }]}>\n                    <TouchableOpacity\n                        style={[container.horizontal, { alignItems: 'center' }]}\n                        onPress={() => props.navigation.navigate(\"ProfileOther\", { uid: user.uid, username: undefined })}>\n\n                        {user.image == 'default' ?\n                            (\n                                <FontAwesome5\n                                    style={[utils.profileImageSmall]}\n                                    name=\"user-circle\" size={35} color=\"black\" />\n\n                            )\n                            :\n                            (\n                                <Image\n                                    style={[utils.profileImageSmall]}\n                                    source={{\n                                        uri: user.image\n                                    }}\n                                />\n                            )\n                        }\n                        <View style={{ alignSelf: 'center' }}>\n                            <Text style={[text.bold, text.medium, { marginBottom: 0 }]} >{user.name}</Text>\n                        </View>\n\n                    </TouchableOpacity>\n\n                    <TouchableOpacity\n                        style={[{ marginLeft: 'auto' }]}\n\n                        onPress={() => {\n                            if (props.route.params.feed) {\n                                props.route.params.setModalShow({ visible: true, item })\n                            } else {\n                                setModalShow({ visible: true, item })\n                            }\n                        }}>\n                        <Feather\n                            name=\"more-vertical\" size={20} color=\"black\" />\n                    </TouchableOpacity>\n                </View>\n                {item.type == 0 ?\n                    <View>\n                        {props.route.params.index == props.route.params.inViewPort && isFocused ?\n                            <View>\n                                <VideoPlayer\n                                    videoProps={{\n                                        isLooping: true,\n                                        shouldPlay: true,\n                                        resizeMode: Video.RESIZE_MODE_COVER,\n                                        source: {\n                                            uri: item.downloadURL,\n                                        },\n                                        videoRef: _handleVideoRef,\n                                    }}\n                                    inFullscreen={false}\n                                    showControlsOnLoad={true}\n                                    showFullscreenButton={false}\n                                    height={WINDOW_WIDTH}\n                                    width={WINDOW_WIDTH}\n                                    shouldPlay={true}\n                                    isLooping={true}\n                                    style={{\n                                        aspectRatio: 1 / 1, height: WINDOW_WIDTH,\n                                        width: WINDOW_WIDTH, backgroundColor: 'black'\n                                    }}\n                                />\n\n                                <TouchableOpacity\n                                    style={{ position: 'absolute', borderRadius: 500, backgroundColor: 'black', width: 40, height: 40, alignItems: 'center', justifyContent: 'center', margin: 10, right: 0 }}\n                                    activeOpacity={1}\n                                    onPress={() => {\n                                        if (videoref == null) {\n                                            return;\n                                        }\n                                        if (unmutted) {\n                                            if (props.route.params.setUnmuttedMain == undefined) {\n                                                setUnmutted(false)\n                                            } else {\n                                                props.route.params.setUnmuttedMain(false)\n\n                                            }\n\n                                        } else {\n                                            if (props.route.params.setUnmuttedMain == undefined) {\n                                                setUnmutted(true)\n                                            } else {\n                                                props.route.params.setUnmuttedMain(true)\n\n                                            }\n\n                                        }\n\n                                    }}>\n                                    {!unmutted ?\n\n                                        <Feather name=\"volume-2\" size={20} color=\"white\" />\n                                        :\n                                        <Feather name=\"volume-x\" size={20} color=\"white\" />\n                                    }\n                                </TouchableOpacity>\n\n                            </View>\n\n                            :\n                            <View style={{ marginTop: 4 }}>\n\n                                <CachedImage\n                                    cacheKey={item.id}\n                                    style={[container.image]}\n                                    source={{ uri: item.downloadURLStill }}\n                                />\n                            </View>\n                        }\n\n                    </View>\n\n                    :\n\n                    <CachedImage\n                        cacheKey={item.id}\n                        style={container.image}\n                        source={{ uri: item.downloadURL }}\n                    />\n                }\n\n                <View style={[utils.padding10, container.horizontal]}>\n                    {currentUserLike ?\n                        (\n                            <Entypo name=\"heart\" size={30} color=\"red\" onPress={() => onDislikePress(user.uid, item.id, item)} />\n                        )\n                        :\n                        (\n                            <Feather name=\"heart\" size={30} color=\"black\" onPress={() => onLikePress(user.uid, item.id, item)} />\n\n                        )\n                    }\n                    <Feather style={utils.margin15Left} name=\"message-square\" size={30} color=\"black\" onPress={() => props.navigation.navigate('Comment', { postId: item.id, uid: user.uid, user })} />\n                    <Feather style={utils.margin15Left} name=\"share\" size={26} color=\"black\" onPress={() => props.navigation.navigate('ChatList', { postId: item.id, post: { ...item, user: user }, share: true })} />\n\n\n                </View>\n                <View style={[container.container, utils.padding10Sides]}>\n                    <Text style={[text.bold, text.medium]}>\n                        {item.likesCount} likes\n                    </Text>\n                    <Text style={[utils.margin15Right, utils.margin5Bottom]}>\n                        <Text style={[text.bold]}\n                            onPress={() => props.navigation.navigate(\"ProfileOther\", { uid: user.uid, username: undefined })}>\n                            {user.name}\n                        </Text>\n\n                        <Text>    </Text>\n                        <ParsedText\n                            parse={\n                                [\n                                    { pattern: /@(\\w+)/, style: { color: 'green', fontWeight: 'bold' }, onPress: onUsernamePress },\n                                ]\n                            }\n                        >{item.caption}</ParsedText>\n\n                    </Text>\n                    <Text\n                        style={[text.grey, utils.margin5Bottom]} onPress={() => props.navigation.navigate('Comment', { postId: item.id, uid: user.uid, user })}>\n                        View all {item.commentsCount} Comments\n                    </Text>\n                    <Text\n                        style={[text.grey, text.small, utils.margin5Bottom]}>\n                        {timeDifference(new Date(), item.creation.toDate())}\n                    </Text>\n                </View>\n            </View>\n\n            <BottomSheet\n                bottomSheerColor=\"#FFFFFF\"\n                ref={setSheetRef}\n                initialPosition={0} //200, 300\n                snapPoints={[300, 0]}\n                isBackDrop={true}\n                isBackDropDismissByPress={true}\n                isRoundBorderWithTipHeader={true}\n                backDropColor=\"black\"\n                isModal\n                containerStyle={{ backgroundColor: \"white\" }}\n                tipStyle={{ backgroundColor: \"white\" }}\n                headerStyle={{ backgroundColor: \"white\", flex: 1 }}\n                bodyStyle={{ backgroundColor: \"white\", flex: 1, borderRadius: 20 }}\n                body={\n\n                    <View>\n\n                        {modalShow.item != null ?\n                            <View>\n                                <TouchableOpacity style={{ padding: 20 }}\n                                    onPress={() => {\n                                        props.navigation.navigate(\"ProfileOther\", { uid: modalShow.item.user.uid, username: undefined });\n                                        setModalShow({ visible: false, item: null });\n                                    }}>\n                                    <Text >Profile</Text>\n                                </TouchableOpacity>\n                                <Divider />\n                                {props.route.params.user.uid == firebase.auth().currentUser.uid ?\n                                    <TouchableOpacity style={{ padding: 20 }}\n                                        onPress={() => {\n                                            props.deletePost(modalShow.item).then(() => {\n                                                props.fetchUserPosts()\n                                                props.navigation.popToTop()\n                                            })\n                                            setModalShow({ visible: false, item: null });\n                                        }}>\n                                        <Text >Delete</Text>\n                                    </TouchableOpacity>\n                                    : null}\n\n                                <Divider />\n                                <TouchableOpacity style={{ padding: 20 }} onPress={() => setModalShow({ visible: false, item: null })}>\n                                    <Text >Cancel</Text>\n                                </TouchableOpacity>\n                            </View>\n                            : null}\n\n                    </View>\n                }\n            />\n            <Snackbar\n                visible={isValid.boolSnack}\n                duration={2000}\n                onDismiss={() => { setIsValid({ boolSnack: false }) }}>\n                {isValid.message}\n            </Snackbar>\n        </View>\n    )\n}\n\nconst mapStateToProps = (store) => ({\n    currentUser: store.userState.currentUser,\n    following: store.userState.following,\n    feed: store.usersState.feed,\n    usersFollowingLoaded: store.usersState.usersFollowingLoaded,\n})\n\nconst mapDispatchProps = (dispatch) => bindActionCreators({ sendNotification, fetchUserPosts, deletePost }, dispatch);\n\nexport default connect(mapStateToProps, mapDispatchProps)(Post);\n"]},"metadata":{},"sourceType":"module"}